<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Book Tracker</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
</head>

<body>
Hello World
</body>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyA--MKrE_Wuxu7OV5rblzX81JVzl3u-LUw",
    authDomain: "book-tracker-3f313.firebaseapp.com",
    databaseURL: "https://book-tracker-3f313.firebaseio.com",
    projectId: "book-tracker-3f313",
    storageBucket: "",
    messagingSenderId: "499909769514"
  };
  firebase.initializeApp(config);

  var provider = new firebase.auth.GoogleAuthProvider();
  firebase.auth().signInWithPopup(provider).then(function(result) {
    // This gives you a Google Access Token. You can use it to access the Google API.
    var token = result.credential.accessToken;
    // The signed-in user info.
    var user = result.user;
    console.log(user);
    if (user.displayName == "Patrick Sweetman") {
      //Show add book screen
      alert("Welcome home " + user.displayName);
      displayAddBook();
    } else {
      //Show permission denied
      alert("Only Patrick may access this site");
    }
    // ...
  }).catch(function(error) {
    // Handle Errors here.
    var errorCode = error.code;
    var errorMessage = error.message;
    // The email of the user's account used.
    var email = error.email;
    // The firebase.auth.AuthCredential type that was used.
    var credential = error.credential;
    alert("Sign-in Failed: " + errorMessage);
    // ...
  });

  function displayAddBook() {
    $("body").html(
      "<div class='container'>" +
        "<div class='text-center align-middle'> " +
          '<div class="form-group">' +
            '<label for="bookTitle">New Book</label>' +
            '<input type="text" class="form-control" id="bookTitle" aria-describedby="bookTitle" placeholder="Enter book title">' +
          '</div>' +
          '<div class="form-group">' +
            '<label for="bookRating">Book Rating</label>' +
            '<select class="form-control" id="bookRating">' +
              '<option>1</option>' +
              '<option>2</option>' +
              '<option>3</option>' +
              '<option>4</option>' +
              '<option>5</option>' +
            '</select>' +
          '</div>' +
          "<a id='btnAddBook'class='btn btn-primary'>Add Book</a>" +
        "</div>" +
      "</div>"
    );

    $("#btnAddBook").click(function() {
      let bookTitle = $("#bookTitle").val();
      let bookRating = $("#bookRating").val();
      let year = (new Date()).getFullYear();
      if (bookTitle.length > 0) {
        firebase.database().ref(year + '/' + bookTitle).set({
          rating: bookRating,
        });
      }
    })
  }

</script>

</html>
